name: Frontend Deploy to EC2

on:
  push:
    branches: ["main"] # 배포할 브랜치 이름 확인!

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. 소스 코드 가져오기
      - name: Checkout source code
        uses: actions/checkout@v3

      # 2. Node.js 세팅
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18" # 프로젝트 버전에 맞게 수정

      # 3. 의존성 설치 및 빌드
      - name: Install Dependencies and Build
        run: |
          npm install
          npm run build
          # 빌드 결과물이 'build' 폴더인지 'dist' 폴더인지 꼭 확인하세요!
          # Vite를 쓰면 dist, CRA를 쓰면 build 입니다.

      # 4. EC2로 파일 전송 (SCP)
      - name: Copy files to EC2
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USERNAME }}
          key: ${{ secrets.EC2_SSH_KEY }}
          source: "dist/*" # 또는 "build/*" (자신의 빌드 폴더명)
          target: "/var/www/html"
          strip_components: 1 # 폴더 껍데기(dist)는 벗기고 내용물만 전송
